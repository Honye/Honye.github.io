{"title":"Postman ä½¿ç”¨ä¹‹ Scripts","slug":"Postmanä½¿ç”¨ä¹‹Scripts","date":"2018-11-25T22:02:53.000Z","updated":"2020-12-12T15:48:00.196Z","comments":true,"path":"api/articles/Postmanä½¿ç”¨ä¹‹Scripts.json","excerpt":"åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸éœ€è¦ç”¨åˆ°ç™»å½•æˆæƒï¼Œå¤§å¤šæ¥å£éƒ½éœ€è¦æºå¸¦ Auth ä¿¡æ¯ã€‚åœ¨ Postman ä¸­è°ƒè¯•æ¥å£æ—¶å‘é€ç™»å½•è¯·æ±‚åå†å¤åˆ¶ç²˜è´´ Tokenï¼Œéº»çƒ¦ã€‚Postman çš„ Scripts åŠŸèƒ½å¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®˜æ–‡ï¼šhttps://learning.getpostman.com/docs/postman/scripts/intro_to_scripts/","covers":["../images/20181118172735.png","../images/20181118172817.png","../images/20181118172846.png"],"content":"<p>åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸éœ€è¦ç”¨åˆ°ç™»å½•æˆæƒï¼Œå¤§å¤šæ¥å£éƒ½éœ€è¦æºå¸¦ Auth ä¿¡æ¯ã€‚åœ¨ Postman ä¸­è°ƒè¯•æ¥å£æ—¶å‘é€ç™»å½•è¯·æ±‚åå†å¤åˆ¶ç²˜è´´ Tokenï¼Œéº»çƒ¦ã€‚Postman çš„ Scripts åŠŸèƒ½å¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>å®˜æ–‡ï¼š<a href=\"https://learning.getpostman.com/docs/postman/scripts/intro_to_scripts/\" target=\"_blank\" rel=\"noopener\">https://learning.getpostman.com/docs/postman/scripts/intro_to_scripts/</a></p>\n<a id=\"more\"></a>\n\n<h2 id=\"Test-scripts\"><a href=\"#Test-scripts\" class=\"headerlink\" title=\"Test scripts\"></a>Test scripts</h2><p>Test scripts æ˜¯åœ¨è¯·æ±‚ç»“æŸåè¿è¡Œçš„ JavaScript è„šæœ¬ã€‚åœ¨ç™»å½•è¯·æ±‚ç»“æŸåå°† Token è®¾ç½®åˆ°<a href=\"https://learning.getpostman.com/docs/postman/environments_and_globals/intro_to_environments_and_globals\" target=\"_blank\" rel=\"noopener\">ç¯å¢ƒå˜é‡</a>ä¸­ï¼Œåœ¨éœ€è¦ Auth çš„æ¥å£ä¸­å–ç”¨å˜é‡ã€‚</p>\n<h3 id=\"pm-test\"><a href=\"#pm-test\" class=\"headerlink\" title=\"pm.test\"></a>pm.test</h3><p><code>pm.test(testName:String, specFunction:Function):Function</code> å¯ä»¥ç”¨æ¥ç¡®è®¤ Response æ˜¯å¦å’Œé¢„æœŸè¿”å›çš„ä¸€è‡´ã€‚</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">param</th>\n<th align=\"left\">description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">testName</td>\n<td align=\"left\">æµ‹è¯•åï¼Œåœ¨ <strong>Test Results</strong> é¢æ¿ä¸­æ˜¾ç¤º</td>\n</tr>\n<tr>\n<td align=\"left\">specFunction</td>\n<td align=\"left\">æµ‹è¯•æ‰§è¡Œå‡½æ•°</td>\n</tr>\n</tbody></table>\n<p>é¦–å…ˆç¡®è®¤ Request æ˜¯å¦è¯·æ±‚æˆåŠŸï¼ŒHTTP çŠ¶æ€ç ä¸º 200ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm.test(<span class=\"string\">\"Status code is 200\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pm.response.to.have.status(<span class=\"number\">200</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>æ¥ç€åˆ¤æ–­ Response æ˜¯å¦å¦‚æœŸè¿”å› tokenã€‚å¦‚æœæœ‰è¿”å›å°±è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç®¡äº†ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm.test(<span class=\"string\">\"Response has token\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pm.response.to.have.jsonBody(<span class=\"string\">\"token\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸Šé¢æ–­è¨€ä¸é€šè¿‡ï¼Œä¸‹é¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = pm.response.json().token;</span><br><span class=\"line\">    pm.environment.set(<span class=\"string\">\"token\"</span>, token);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>åˆå¹¶ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm.test(<span class=\"string\">\"Status code is 200\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pm.response.to.have.status(<span class=\"number\">200</span>);</span><br><span class=\"line\">    pm.test(<span class=\"string\">'Response has token'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        pm.response.to.have.jsonBody(<span class=\"string\">\"token\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> token = pm.response.json().token;</span><br><span class=\"line\">        pm.environment.set(<span class=\"string\">\"token\"</span>, token);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"../images/20181118172735.png\" alt=\"Test Results (1)\"></p>\n<p><img src=\"../images/20181118172817.png\" alt=\"Test Results (2)\"></p>\n<h2 id=\"Variables\"><a href=\"#Variables\" class=\"headerlink\" title=\"Variables\"></a>Variables</h2><p>ç»è¿‡ä¸Šè¿°çš„ Test scripts å·²ç»å°†ç™»å½•è¯·æ±‚å¾—åˆ°çš„ token è®¾ç½®åˆ°äº†ç¯å¢ƒå˜é‡ä¸­ã€‚ç°åœ¨åœ¨éœ€è¦éªŒè¯ Auth ä¿¡æ¯çš„è¯·æ±‚ä¸­å¼•ç”¨å˜é‡ï¼Œä»¥ Authorizationä¸ºä¾‹ã€‚</p>\n<p>å˜é‡å¼•ç”¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡ <code><span>{</span>{variableName}}</code> çš„å½¢å¼è®¿é—®ï¼Œè¿™ç§å½¢å¼åªèƒ½åœ¨ Request Builder ä¸­ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯åªèƒ½åœ¨ URLã€Paramsã€Authorzationã€Headersã€Body ä¸­ä½¿ç”¨ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ Scripts è®¿é—®ï¼Œå¦‚ä¸Šè¿°ç”¨åˆ°çš„ <code>pm.enviroment.set(variableName:String, variableValue:String)</code>ã€‚æ›´å¤šæŸ¥é˜…å®˜æ–‡ï¼š<a href=\"https://learning.getpostman.com/docs/postman/environments_and_globals/variables\" target=\"_blank\" rel=\"noopener\">https://learning.getpostman.com/docs/postman/environments_and_globals/variables</a></p>\n<p>Authorization ğŸŒ°ï¼š</p>\n<p><img src=\"../images/20181118172846.png\" alt=\"Variables demo\"></p>\n<h2 id=\"More\"><a href=\"#More\" class=\"headerlink\" title=\"More\"></a>More</h2><p>Postman çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œçµæ´»åº”ç”¨å¯ä»¥å¾ˆå¥½æé«˜å·¥ä½œæ•ˆç‡å’Œè´¨é‡ã€‚æ¯”å¦‚çµæ´»ä½¿ç”¨ <a href=\"https://learning.getpostman.com/docs/postman/environments_and_globals/intro_to_environments_and_globals\" target=\"_blank\" rel=\"noopener\">Environment</a> å¯ä»¥æ–¹ä¾¿çš„åœ¨æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒåˆ‡æ¢ï¼Œä½¿ç”¨ <a href=\"https://learning.getpostman.com/docs/postman/scripts/intro_to_scripts\" target=\"_blank\" rel=\"noopener\">Scripts</a> å¯ä»¥å®ç°ä¾æ¬¡å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæˆ–è€… token å¤±æ•ˆåè‡ªåŠ¨åˆ·æ–° tokenã€‚æ´»å­¦æ´»ç”¨æŸ¥é˜…å®˜æ–‡ï¼š<a href=\"https://learning.getpostman.com/docs\" target=\"_blank\" rel=\"noopener\">https://learning.getpostman.com/docs</a></p>\n","more":"<h2 id=\"Test-scripts\"><a href=\"#Test-scripts\" class=\"headerlink\" title=\"Test scripts\"></a>Test scripts</h2><p>Test scripts æ˜¯åœ¨è¯·æ±‚ç»“æŸåè¿è¡Œçš„ JavaScript è„šæœ¬ã€‚åœ¨ç™»å½•è¯·æ±‚ç»“æŸåå°† Token è®¾ç½®åˆ°<a href=\"https://learning.getpostman.com/docs/postman/environments_and_globals/intro_to_environments_and_globals\" target=\"_blank\" rel=\"noopener\">ç¯å¢ƒå˜é‡</a>ä¸­ï¼Œåœ¨éœ€è¦ Auth çš„æ¥å£ä¸­å–ç”¨å˜é‡ã€‚</p>\n<h3 id=\"pm-test\"><a href=\"#pm-test\" class=\"headerlink\" title=\"pm.test\"></a>pm.test</h3><p><code>pm.test(testName:String, specFunction:Function):Function</code> å¯ä»¥ç”¨æ¥ç¡®è®¤ Response æ˜¯å¦å’Œé¢„æœŸè¿”å›çš„ä¸€è‡´ã€‚</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">param</th>\n<th align=\"left\">description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">testName</td>\n<td align=\"left\">æµ‹è¯•åï¼Œåœ¨ <strong>Test Results</strong> é¢æ¿ä¸­æ˜¾ç¤º</td>\n</tr>\n<tr>\n<td align=\"left\">specFunction</td>\n<td align=\"left\">æµ‹è¯•æ‰§è¡Œå‡½æ•°</td>\n</tr>\n</tbody></table>\n<p>é¦–å…ˆç¡®è®¤ Request æ˜¯å¦è¯·æ±‚æˆåŠŸï¼ŒHTTP çŠ¶æ€ç ä¸º 200ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm.test(<span class=\"string\">\"Status code is 200\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pm.response.to.have.status(<span class=\"number\">200</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>æ¥ç€åˆ¤æ–­ Response æ˜¯å¦å¦‚æœŸè¿”å› tokenã€‚å¦‚æœæœ‰è¿”å›å°±è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç®¡äº†ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm.test(<span class=\"string\">\"Response has token\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pm.response.to.have.jsonBody(<span class=\"string\">\"token\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸Šé¢æ–­è¨€ä¸é€šè¿‡ï¼Œä¸‹é¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = pm.response.json().token;</span><br><span class=\"line\">    pm.environment.set(<span class=\"string\">\"token\"</span>, token);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>åˆå¹¶ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm.test(<span class=\"string\">\"Status code is 200\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pm.response.to.have.status(<span class=\"number\">200</span>);</span><br><span class=\"line\">    pm.test(<span class=\"string\">'Response has token'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        pm.response.to.have.jsonBody(<span class=\"string\">\"token\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> token = pm.response.json().token;</span><br><span class=\"line\">        pm.environment.set(<span class=\"string\">\"token\"</span>, token);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"../images/20181118172735.png\" alt=\"Test Results (1)\"></p>\n<p><img src=\"../images/20181118172817.png\" alt=\"Test Results (2)\"></p>\n<h2 id=\"Variables\"><a href=\"#Variables\" class=\"headerlink\" title=\"Variables\"></a>Variables</h2><p>ç»è¿‡ä¸Šè¿°çš„ Test scripts å·²ç»å°†ç™»å½•è¯·æ±‚å¾—åˆ°çš„ token è®¾ç½®åˆ°äº†ç¯å¢ƒå˜é‡ä¸­ã€‚ç°åœ¨åœ¨éœ€è¦éªŒè¯ Auth ä¿¡æ¯çš„è¯·æ±‚ä¸­å¼•ç”¨å˜é‡ï¼Œä»¥ Authorizationä¸ºä¾‹ã€‚</p>\n<p>å˜é‡å¼•ç”¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡ <code><span>{</span>{variableName}}</code> çš„å½¢å¼è®¿é—®ï¼Œè¿™ç§å½¢å¼åªèƒ½åœ¨ Request Builder ä¸­ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯åªèƒ½åœ¨ URLã€Paramsã€Authorzationã€Headersã€Body ä¸­ä½¿ç”¨ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ Scripts è®¿é—®ï¼Œå¦‚ä¸Šè¿°ç”¨åˆ°çš„ <code>pm.enviroment.set(variableName:String, variableValue:String)</code>ã€‚æ›´å¤šæŸ¥é˜…å®˜æ–‡ï¼š<a href=\"https://learning.getpostman.com/docs/postman/environments_and_globals/variables\" target=\"_blank\" rel=\"noopener\">https://learning.getpostman.com/docs/postman/environments_and_globals/variables</a></p>\n<p>Authorization ğŸŒ°ï¼š</p>\n<p><img src=\"../images/20181118172846.png\" alt=\"Variables demo\"></p>\n<h2 id=\"More\"><a href=\"#More\" class=\"headerlink\" title=\"More\"></a>More</h2><p>Postman çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œçµæ´»åº”ç”¨å¯ä»¥å¾ˆå¥½æé«˜å·¥ä½œæ•ˆç‡å’Œè´¨é‡ã€‚æ¯”å¦‚çµæ´»ä½¿ç”¨ <a href=\"https://learning.getpostman.com/docs/postman/environments_and_globals/intro_to_environments_and_globals\" target=\"_blank\" rel=\"noopener\">Environment</a> å¯ä»¥æ–¹ä¾¿çš„åœ¨æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒåˆ‡æ¢ï¼Œä½¿ç”¨ <a href=\"https://learning.getpostman.com/docs/postman/scripts/intro_to_scripts\" target=\"_blank\" rel=\"noopener\">Scripts</a> å¯ä»¥å®ç°ä¾æ¬¡å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæˆ–è€… token å¤±æ•ˆåè‡ªåŠ¨åˆ·æ–° tokenã€‚æ´»å­¦æ´»ç”¨æŸ¥é˜…å®˜æ–‡ï¼š<a href=\"https://learning.getpostman.com/docs\" target=\"_blank\" rel=\"noopener\">https://learning.getpostman.com/docs</a></p>","categories":[],"tags":[]}